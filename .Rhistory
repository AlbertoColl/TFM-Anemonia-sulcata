width = 0.1, color = "#383838") +
geom_point(aes(color = species), shape = "diamond", size = 8) +
scale_color_manual(values = bird_palette) +
labs(title = "Slopes for Linear Model:\n Breeding Success ~ Year") +
xlab("Species") +
ylab("Slope") +
theme_custom() +
theme(legend.position = "none",
panel.grid.major.x = element_blank(),
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 10, face = "bold.italic")))
(plot_output <- ggplot(lm_output, aes(x = species, y = slope)) +
geom_hline(yintercept = 0, color = "red") +
geom_errorbar(aes(x = species, ymin = slope-slope.error, ymax = slope+slope.error),
width = 0.1, color = "#383838") +
geom_point(aes(color = species), shape = "diamond", size = 10) +
scale_color_manual(values = bird_palette) +
labs(title = "Slopes for Linear Model:\n Breeding Success ~ Year") +
xlab("Species") +
ylab("Slope") +
theme_custom() +
theme(legend.position = "none",
panel.grid.major.x = element_blank(),
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 10, face = "bold.italic")))
(plot_output <- ggplot(lm_output, aes(x = species, y = slope)) +
geom_hline(yintercept = 0, color = "red") +
geom_errorbar(aes(x = species, ymin = slope-slope.error, ymax = slope+slope.error),
width = 0.1, color = "#383838") +
geom_point(aes(color = species), shape = "diamond", size = 9) +
scale_color_manual(values = bird_palette) +
labs(title = "Slopes for Linear Model:\n Breeding Success ~ Year") +
xlab("Species") +
ylab("Slope") +
theme_custom() +
theme(legend.position = "none",
panel.grid.major.x = element_blank(),
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 10, face = "bold.italic")))
(plot_output <- ggplot(lm_output, aes(x = species, y = slope)) +
geom_hline(yintercept = 0, color = "red") +
geom_errorbar(aes(x = species, ymin = slope-slope.error, ymax = slope+slope.error),
width = 0.1, color = "#383838") +
geom_point(aes(color = species), shape = "diamond", size = 10) +
scale_color_manual(values = bird_palette) +
labs(title = "Slopes for Linear Model:\n Breeding Success ~ Year") +
xlab("Species") +
ylab("Slope") +
theme_custom() +
theme(legend.position = "none",
panel.grid.major.x = element_blank(),
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 10, face = "bold.italic")))
ggsave("C:\Users\collf\Documents\plot.png", width = 600, heigth = 500)
ggsave("C:/Users/collf/Documents/plot.png", width = 600, heigth = 500)
ggsave("C:/Users/collf/Documents/plot.png", width = 600, heigth = 500, limitsize = F)
ggsave("C:/Users/collf/Documents/plot.png", width = 600, height = 500, limitsize = F)
setwd("C:/Users/collf/Documents/")
ggsave("C:/Users/collf/Documents/plot.png", width = 600, height = 500, limitsize = F)
broom::tidy(lm(x$breedingSuccess ~ I(x$year-1981), data = x))[1:2,1:5]
# Y ahora lapply los modelos + tidy/glance para sacar parametros, error y r2
lm_estimates <- lapply(by_species, function(x){
broom::tidy(lm(x$breedingSuccess ~ I(x$year-1981), data = x))[1:2,1:5]
})
View(lm_estimates)
lm_estimates
lm_goodness <- lapply(by_species, function(x){
broom::glance(lm(x$breedingSuccess ~ I(x$year-1981), data = x))[1,1:2]
})
lm_goodness
mt <- matrix(1:6,3,2)
mt[,-1]
a <- c(3,0,T)
b <- c(4,0,F)
c <- (a|b)
c
x <- c(2L, 3L, 4L, 15L, 23L, 43L)
typeof(median(x))
x <- as.Date("2018-10-01")
x
months(x)
month(x)
v <- 1:·
v <- 1:3
names(v) <- c("a", "b", "c")
v[4] <- 4
v
install.packages("igraph")
v1 <- 1:5
v2 <- rep(1,5)
v1+v2
v2 <- v1+v2
v2 <- v1+v2
v2 <- v1+v2
cor(v1,v2)
library(igraph)
g1 <- graph(edges = c(1,2, 2,3, 3,1 ), n = 3)
g1
plot(g1)
a <- c(1,2, 2,3, 3,1 )
g1 <- graprh(c("John", "Jean", "Jim"), )
g1 <- graph(c("John","Jean", "Jean","Jim", "Jim","John"), n = 3, directed = F)
g1 <- graph(c("John","Jean", "Jean","Jim", "Jim","John"), directed = F)
plot(g1)
g1
E(g1)
View(g1)
V(g1)
g1[]
install.packages("enaR")
library("enaR")
version
sessioninfo()
sessionInfo()
## SETUP ----
library(tidyverse)
library(ggthemr)
library(broom)
library(car)
library(multcompView)
ggthemr("fresh")
### SETUP ----
library(tidyverse)
install.packages("installr")
library(installr)
updateR()
### SETUP ----
library(tidyverse)
install.packages("tinytex")
tinytex::install_tinytex()
tinytex::install_tinytex()
setwd("D:\collf\Documents")
setwd("D:\collf\Documents")
setwd("D:/collf/Documents")
datos <- read.csv("Results.csv")
View(datos)
hist(datos, Area)
hist(datos$Area)
library(ggplot2)
p <- ggplot(datos) +
geom_histogram(aes(x = Area))
(p <- ggplot(datos) +
geom_histogram(aes(x = Area))
)
geom_histogram(aes(x = log(Area))
(p <- ggplot(datos) +
(p <- ggplot(datos) +
geom_histogram(aes(x = log(Area)))
)
(p <- ggplot(datos) +
geom_point(aes(x = Area, y = Circ.))
)
(p <- ggplot(datos) +
geom_point(aes(x = log(Area), y = Circ.))
)
install.packages("installr")
library(installr)
updateR()
installed.packages()
install.packages("tidyverse")
#Biplot, ver si puedes cambiar componentes
biplot(PCA, choices = c(1,3), type = c("text", "points"),
col = c("#0c8890", "#414066"), scaling = 1)
## SETUP ----
library(tidyverse)
library(GGally) # Correlograma
library(ggvegan) # fortify()
library(vegan) #PCA
library(psych)
setwd("D:/collf/Documents/GitHub/TFM-Ortiguilla")
#source(file = "./scripts/0_data_lab.R") # Laboratorio
source(file = "./scripts/0_data_home.R") # En casa
source(file = "./scripts/1_funciones_graficas.R")
ggthemr("fresh")
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca <- select(datos, SOD.pie, SOD.tent, CAT.pie, CAT.tent, GST.pie, GST.tent, MDA.pie.2, MDA.tent.2, TEAC.pie, TEAC.tent)
names(datos_pca)[7:8] <- c("MDA.tent", "MDA.pie")
outlier(datos_pca) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
datos_pca <- datos_pca[-c(9, 19), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Ejecutar PCA
PCA <- rda(na.omit(datos_pca), scale = TRUE)
sum((as.vector(PCA$CA$eig)/sum(PCA$CA$eig))[1:3])
### Graficas y resultados PCA ----
#Extraer eigenvalues y hacer Scree plot bonico con ggplot
eigenvalues <- as.data.frame(PCA$CA$eig) %>%
rename("eigenvalue"="PCA$CA$eig") %>%
mutate(var_per = eigenvalue/sum(eigenvalue)) %>%
rownames_to_column(var = "PC")
eigenvalues$PC <- factor(eigenvalues$PC, levels = c("PC1", "PC2", "PC3", "PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10", "PC11", "PC12", "PC13"))
# Scree plot
(scree.plot <- ggplot(eigenvalues, aes(x = PC,y = var_per)) +
geom_line(group = 1, color = "#3EB59B") +
geom_point(size = 3, color = "#0c8890") +
theme_tfm() +
scale_y_continuous(labels = scales::percent, limits = c(0,0.5)) +
xlab("Compontenes Principales") +
ylab("% de variación explicada"))
# Factor loadings, exportar en csv para hacer tabla
factor_loading <- rownames_to_column(as.data.frame(t(as.data.frame(PCA[["CA"]][["v"]]))))
names(factor_loading)[1] <- "PC"
#Biplot, ver si puedes cambiar componentes
biplot(PCA, choices = c(1,3), type = c("text", "points"),
col = c("#0c8890", "#414066"), scaling = 1)
#Biplot, ver si puedes cambiar componentes
biplot(PCA, choices = c(1,2), type = c("text", "points"),
col = c("#0c8890", "#414066"), scaling = 1)
PCA_df <- fortify(PCA) %>%
mutate(Score = ifelse(Score == "species", "variable", "observation"))
View(PCA_df)
(pca.plot <- ggplot() +
geom_hline(yintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_vline(xintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_point(data = filter(PCA_df, Score == "observation"),
aes(x = PC1, y = PC2),
size = 2.5, alpha = 0.8, shape = 19) +
geom_segment(data = filter(PCA_df, Score == "variable"),
aes(x = 0, y = 0, xend = PC1*1.5, yend = PC2*1.5),
color = "#E56A1C", alpha = 0.8, linewidth = 0.6,
arrow = arrow(length=unit(0.3,"cm"))) +
geom_text(data = filter(PCA_df, Score == "variable"),
aes(x = PC1, y = PC2, label = Label), alpha = 0.9,
position =  position_jitter(width = 0.1),
fontface = "bold", color = "gray20", size = 3.25) +
#ylim(c(-2, 2)) +
xlim(c(-2.5,2.5)) +
xlab(paste0("Componente Principal 1 (", round(eigenvalues$var_per[1]*100, 2) ,"%)")) +
ylab(paste0("Componente Principal 2 (", round(eigenvalues$var_per[2]*100, 2) ,"%)")) +
theme_tfm())
(pca.plot <- ggplot() +
geom_hline(yintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_vline(xintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_point(data = filter(PCA_df, Score == "observation"),
aes(x = PC1, y = PC2),
size = 2.5, alpha = 0.8, shape = 19) +
geom_segment(data = filter(PCA_df, Score == "variable"),
aes(x = 0, y = 0, xend = PC1*1.5, yend = PC2*1.5),
color = "#E56A1C", alpha = 0.8, linewidth = 0.6,
arrow = arrow(length=unit(0.3,"cm"))) +
geom_text(data = filter(PCA_df, Score == "variable"),
aes(x = PC1*1.5, y = PC2*1.5, label = Label), alpha = 0.9,
position =  position_jitter(width = 0.1),
fontface = "bold", color = "gray20", size = 3.25) +
#ylim(c(-2, 2)) +
xlim(c(-2.5,2.5)) +
xlab(paste0("Componente Principal 1 (", round(eigenvalues$var_per[1]*100, 2) ,"%)")) +
ylab(paste0("Componente Principal 2 (", round(eigenvalues$var_per[2]*100, 2) ,"%)")) +
theme_tfm())
ggsave("./resultados/graficas/PCA_biplot.png", width = 1000, height = 770, units = "px",
scale = 2, dpi = "retina")
ggsave("./resultados/graficas/PCA_biplot.png", width = 1000, height = 770, units = "px",
scale = 2, dpi = "retina")
(pca.plot <- ggplot() +
geom_hline(yintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_vline(xintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_point(data = filter(PCA_df, Score == "observation"),
aes(x = PC1, y = PC2),
size = 2.5, alpha = 0.8, shape = 19) +
geom_segment(data = filter(PCA_df, Score == "variable"),
aes(x = 0, y = 0, xend = PC1*2, yend = PC2*2),
color = "#E56A1C", alpha = 0.8, linewidth = 0.6,
arrow = arrow(length=unit(0.3,"cm"))) +
geom_text(data = filter(PCA_df, Score == "variable"),
aes(x = PC1*2, y = PC2*2, label = Label), alpha = 0.9,
position =  position_jitter(width = 0.1),
fontface = "bold", color = "gray20", size = 3.25) +
#ylim(c(-2, 2)) +
xlim(c(-2.5,2.5)) +
xlab(paste0("Componente Principal 1 (", round(eigenvalues$var_per[1]*100, 2) ,"%)")) +
ylab(paste0("Componente Principal 2 (", round(eigenvalues$var_per[2]*100, 2) ,"%)")) +
theme_tfm())
(pca.plot <- ggplot() +
geom_hline(yintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_vline(xintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_point(data = filter(PCA_df, Score == "observation"),
aes(x = PC1, y = PC2),
size = 2.5, alpha = 0.8, shape = 19) +
geom_segment(data = filter(PCA_df, Score == "variable"),
aes(x = 0, y = 0, xend = PC1*2.5, yend = PC2*2.5),
color = "#E56A1C", alpha = 0.8, linewidth = 0.6,
arrow = arrow(length=unit(0.3,"cm"))) +
geom_text(data = filter(PCA_df, Score == "variable"),
aes(x = PC1*2.5, y = PC2*2.5, label = Label), alpha = 0.9,
position =  position_jitter(width = 0.1),
fontface = "bold", color = "gray20", size = 3.25) +
#ylim(c(-2, 2)) +
xlim(c(-2.5,2.5)) +
xlab(paste0("Componente Principal 1 (", round(eigenvalues$var_per[1]*100, 2) ,"%)")) +
ylab(paste0("Componente Principal 2 (", round(eigenvalues$var_per[2]*100, 2) ,"%)")) +
theme_tfm())
(pca.plot <- ggplot() +
geom_hline(yintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_vline(xintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_point(data = filter(PCA_df, Score == "observation"),
aes(x = PC1, y = PC2),
size = 2.5, alpha = 0.8, shape = 19) +
geom_segment(data = filter(PCA_df, Score == "variable"),
aes(x = 0, y = 0, xend = PC1*2.5, yend = PC2*2.5),
color = "#E56A1C", alpha = 0.8, linewidth = 0.6,
arrow = arrow(length=unit(0.3,"cm"))) +
geom_text(data = filter(PCA_df, Score == "variable"),
aes(x = PC1*2.5, y = PC2*2.5, label = Label), alpha = 0.9,
position =  position_jitter(width = 0.1),
fontface = "bold", color = "gray20", size = 3.25) +
xlab(paste0("Componente Principal 1 (", round(eigenvalues$var_per[1]*100, 2) ,"%)")) +
ylab(paste0("Componente Principal 2 (", round(eigenvalues$var_per[2]*100, 2) ,"%)")) +
theme_tfm())
#Biplot, ver si puedes cambiar componentes
biplot(PCA, choices = c(1,2), type = c("text", "points"),
col = c("#0c8890", "#414066"), scaling = 1)
?scale()
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca <- scale(select(datos, SOD.pie, SOD.tent, CAT.pie, CAT.tent, GST.pie, GST.tent, MDA.pie.2, MDA.tent.2, TEAC.pie, TEAC.tent))
names(datos_pca)[7:8] <- c("MDA.tent", "MDA.pie")
outlier(datos_pca) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
datos_pca <- datos_pca[-c(9, 19), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca <- scale(select(datos, SOD.pie, SOD.tent, CAT.pie, CAT.tent, GST.pie, GST.tent, MDA.pie.2, MDA.tent.2, TEAC.pie, TEAC.tent))
names(datos_pca)[7:8] <- c("MDA.tent", "MDA.pie")
outlier(datos_pca) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
datos_pca <- datos_pca[-c(9), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca, label = F, label_alpha = T,
hjust = 0.75, size = 3, color = "grey50", layout.exp = 1,
high = "#3EB59B", mid = "white", low = "#E56A1C") +
labs(title = "Correlacion entre indicadores medidos",
subtitle = "ordenados segun PC1/PC2") +
theme_tfm() +
theme(axis.line = element_blank())
# Ejecutar PCA
PCA <- rda(na.omit(datos_pca), scale = TRUE)
sum((as.vector(PCA$CA$eig)/sum(PCA$CA$eig))[1:3])
datos_pca <- datos_pca[-c(9,19), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca <- scale(select(datos, SOD.pie, SOD.tent, CAT.pie, CAT.tent, GST.pie, GST.tent, MDA.pie.2, MDA.tent.2, TEAC.pie, TEAC.tent))
names(datos_pca)[7:8] <- c("MDA.tent", "MDA.pie")
outlier(datos_pca) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
datos_pca <- datos_pca[-c(9,19), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca, label = F, label_alpha = T,
hjust = 0.75, size = 3, color = "grey50", layout.exp = 1,
high = "#3EB59B", mid = "white", low = "#E56A1C") +
labs(title = "Correlacion entre indicadores medidos",
subtitle = "ordenados segun PC1/PC2") +
theme_tfm() +
theme(axis.line = element_blank())
# Ejecutar PCA
PCA <- rda(na.omit(datos_pca), scale = TRUE)
sum((as.vector(PCA$CA$eig)/sum(PCA$CA$eig))[1:3])
### Graficas y resultados PCA ----
#Extraer eigenvalues y hacer Scree plot bonico con ggplot
eigenvalues <- as.data.frame(PCA$CA$eig) %>%
rename("eigenvalue"="PCA$CA$eig") %>%
mutate(var_per = eigenvalue/sum(eigenvalue)) %>%
rownames_to_column(var = "PC")
eigenvalues$PC <- factor(eigenvalues$PC, levels = c("PC1", "PC2", "PC3", "PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10", "PC11", "PC12", "PC13"))
# Scree plot
(scree.plot <- ggplot(eigenvalues, aes(x = PC,y = var_per)) +
geom_line(group = 1, color = "#3EB59B") +
geom_point(size = 3, color = "#0c8890") +
theme_tfm() +
scale_y_continuous(labels = scales::percent, limits = c(0,0.5)) +
xlab("Compontenes Principales") +
ylab("% de variación explicada"))
outlier(datos_pca) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
# Ejecutar PCA
PCA <- rda(na.omit(datos_pca), scale = TRUE)
### Graficas y resultados PCA ----
#Extraer eigenvalues y hacer Scree plot bonico con ggplot
eigenvalues <- as.data.frame(PCA$CA$eig) %>%
rename("eigenvalue"="PCA$CA$eig") %>%
mutate(var_per = eigenvalue/sum(eigenvalue)) %>%
rownames_to_column(var = "PC")
eigenvalues$PC <- factor(eigenvalues$PC, levels = c("PC1", "PC2", "PC3", "PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10", "PC11", "PC12", "PC13"))
# Scree plot
(scree.plot <- ggplot(eigenvalues, aes(x = PC,y = var_per)) +
geom_line(group = 1, color = "#3EB59B") +
geom_point(size = 3, color = "#0c8890") +
theme_tfm() +
scale_y_continuous(labels = scales::percent, limits = c(0,0.5)) +
xlab("Compontenes Principales") +
ylab("% de variación explicada"))
#Biplot, ver si puedes cambiar componentes
biplot(PCA, choices = c(1,2), type = c("text", "points"),
col = c("#0c8890", "#414066"), scaling = 1)
(pca.plot <- ggplot() +
geom_hline(yintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_vline(xintercept = 0, color = "#096A71", alpha = 0.7, linewidth = 0.05) +
geom_point(data = filter(PCA_df, Score == "observation"),
aes(x = PC1, y = PC2),
size = 2.5, alpha = 0.8, shape = 19) +
geom_segment(data = filter(PCA_df, Score == "variable"),
aes(x = 0, y = 0, xend = PC1, yend = PC2),
color = "#E56A1C", alpha = 0.8, linewidth = 0.6,
arrow = arrow(length=unit(0.3,"cm"))) +
geom_text(data = filter(PCA_df, Score == "variable"),
aes(x = PC1, y = PC2, label = Label), alpha = 0.9,
position =  position_jitter(width = 0.1),
fontface = "bold", color = "gray20", size = 3.25) +
xlab(paste0("Componente Principal 1 (", round(eigenvalues$var_per[1]*100, 2) ,"%)")) +
ylab(paste0("Componente Principal 2 (", round(eigenvalues$var_per[2]*100, 2) ,"%)")) +
theme_tfm())
View(PCA)
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca_2 <- scale(select(datos, SOD.tent, CAT.tent, GST.tent, MDA.tent.2, TEAC.tent, DTD_tent))
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca_2 <- scale(select(datos, SOD.tent, CAT.tent, GST.tent, MDA.tent.2, TEAC.tent, DTD.tent))
names(datos_pca)[4] <- c("MDA.tent")
outlier(datos_pca) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
datos_pca <- datos_pca[-c(7), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca, label = F, label_alpha = T,
hjust = 0.75, size = 3, color = "grey50", layout.exp = 1,
high = "#3EB59B", mid = "white", low = "#E56A1C") +
labs(title = "Correlacion entre indicadores medidos",
subtitle = "ordenados segun PC1/PC2") +
theme_tfm() +
theme(axis.line = element_blank())
outlier(datos_pca_2) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca_"", label = F, label_alpha = T,
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca_2 label = F, label_alpha = T,
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca_2,label = F, label_alpha = T,
hjust = 0.75, size = 3, color = "grey50", layout.exp = 1,
high = "#3EB59B", mid = "white", low = "#E56A1C") +
labs(title = "Correlacion entre indicadores medidos",
subtitle = "ordenados segun PC1/PC2") +
theme_tfm() +
theme(axis.line = element_blank())
# Ejecutar PCA
PCA <- rda(na.omit(datos_pca_2), scale = TRUE)
sum((as.vector(PCA$CA$eig)/sum(PCA$CA$eig))[1:3])
### Graficas y resultados PCA ----
#Extraer eigenvalues y hacer Scree plot bonico con ggplot
eigenvalues <- as.data.frame(PCA$CA$eig) %>%
rename("eigenvalue"="PCA$CA$eig") %>%
mutate(var_per = eigenvalue/sum(eigenvalue)) %>%
rownames_to_column(var = "PC")
eigenvalues$PC <- factor(eigenvalues$PC, levels = c("PC1", "PC2", "PC3", "PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10", "PC11", "PC12", "PC13"))
# Scree plot
(scree.plot <- ggplot(eigenvalues, aes(x = PC,y = var_per)) +
geom_line(group = 1, color = "#3EB59B") +
geom_point(size = 3, color = "#0c8890") +
theme_tfm() +
scale_y_continuous(labels = scales::percent, limits = c(0,0.5)) +
xlab("Compontenes Principales") +
ylab("% de variación explicada"))
# Factor loadings, exportar en csv para hacer tabla
factor_loading <- rownames_to_column(as.data.frame(t(as.data.frame(PCA[["CA"]][["v"]]))))
merge(eigenvalues, factor_loading)
factor_loading <- rownames_to_column(as.data.frame(t(as.data.frame(PCA[["CA"]][["v"]]))))
View(factor_loading)
View(factor_loading)
names(factor_loading)[1] <- "PC"
View(factor_loading)
View(datos_pca_2)
View(eigenvalues)
merge(eigenvalues, factor_loading)
#Biplot, ver si puedes cambiar componentes
biplot(PCA, choices = c(1,2), type = c("text", "points"),
col = c("#0c8890", "#414066"), scaling = 1)
#Biplot, ver si puedes cambiar componentes
biplot(PCA, choices = c(1,2), type = c("text", "points"),
col = c("#0c8890", "#414066"), scaling = 1)
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca_2 <- scale(select(datos, SOD.pie, CAT.pie, GST.pie, MDA.pie.2, TEAC.pie, DTD.pie))
outlier(datos_pca_2) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
datos_pca <- datos_pca[-c(8), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
datos_pca_2 <- datos_pca[-c(8), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca_2,label = F, label_alpha = T,
hjust = 0.75, size = 3, color = "grey50", layout.exp = 1,
high = "#3EB59B", mid = "white", low = "#E56A1C") +
labs(title = "Correlacion entre indicadores medidos",
subtitle = "ordenados segun PC1/PC2") +
theme_tfm() +
theme(axis.line = element_blank())
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca_2,label = F, label_alpha = T,
hjust = 0.75, size = 3, color = "grey50", layout.exp = 1,
high = "#3EB59B", mid = "white", low = "#E56A1C") +
labs(title = "Correlacion entre indicadores medidos",
subtitle = "ordenados segun PC1/PC2") +
theme_tfm() +
theme(axis.line = element_blank())
# Seleccionar variables que incluir en el PCA. ¿Probar separando pie y tentaculo?
datos_pca_2 <- scale(select(datos, SOD.pie, CAT.pie, GST.pie, MDA.pie.2, TEAC.pie, DTD.pie))
outlier(datos_pca_2) # Calcula Distancia de Mahalanobis y hace QQ plot con cuantiles de la chi cuadrado. El unico que parece un outlier mas gordo es el O4, observacion numero 9, desde un punto de vista multivariable.
datos_pca_2 <- datos_pca[-c(8), ] # El punto 9 es potencial outlier pero parece que no influencia mucho el resultado del análisis. Repetir y evaluar de nuevo cuando esten todas las variables.
# Hacer matriz de correlacion
# Ordenar luego manualmente variables segun relevancia en PCA para la grafica
ggcorr(datos_pca_2,label = F, label_alpha = T,
hjust = 0.75, size = 3, color = "grey50", layout.exp = 1,
high = "#3EB59B", mid = "white", low = "#E56A1C") +
labs(title = "Correlacion entre indicadores medidos",
subtitle = "ordenados segun PC1/PC2") +
theme_tfm() +
theme(axis.line = element_blank())
View(datos_pca_2)
