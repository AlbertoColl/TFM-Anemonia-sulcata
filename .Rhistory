library(tidyverse)
library(car)
library(multcompView)
### Setup----
setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
#source(file = "./scripts/0_data_home.R") # En casa
#source(file = "./scripts_enero_2024/1_funciones_graficas.R") # Arreglar setwd en el script citado
### Análisis exploratorio de datos ----
# Comprobacion de normalidad de las variables respuestas GLOBALMENTE
hist(datos$peso.total)
shapiro.test(datos$peso.total)
# SOD mas menos bien en el pie y peor en el tentaculo. Shapiro no significativo
# CAT pie tiene algunos valores extremos, Shapiro salta por poco. Tent igual pero no muy sig, Aceptable creo
# GST no es nada normal. Nada nada. transformar? Transformacion arregla en pie, tent no tanto. Comprobar por grupos
# DTD perfecta que bonica
# G6PDH da problemas en tentaculo, pie no. Comprobar por grupos
# MDA da problemas en pie, ver por grupos
# teac perfecto
# Comprobando normalidad por grupos
hist(filter(datos, tratamiento == "Shade")$peso.total)
shapiro.test(filter(datos, tratamiento == "IMTA")$peso.total)
# GST en pie sale un poco rara en el tratamiento sombreado. Hay un valor que es 715 de repente. Yo probaria a quitarlo
# G6PDH, MDA y CAT estan bien por grupos
### Estudio de datos anómalos e influyentes ----
ggplot(datos, aes(x = tratamiento, y = SOD.tent, color = tratamiento)) +
#geom_boxplot(alpha = 0) +
geom_point(position = position_jitter(height = 0, width = 0.1), size = 2)
# Hay un punto en 20,6, IMTA SOD pie, que esta bstante alejado del resto de su grupo
# [8,8] en catalasa pie, grupo shade esta muy muy desviado. Igual es influyente.
# En GST pie hay otro punto raro de 200 y lgo pero ya he quitado el de 700 que se desviaba mucho mas.
# [9,11] esta muy por encima, quitarlo. Es Shade en GST tent.
# datos[20,6] <- NA # NO HACE FALTA QUITARLO
datos[8,5] <- NA # POTENCIAL OUTLIER EN CLOROFILA
datos[8,10] <- NA # potencial outlier en GST pie
datos[8,8] <- NA # potencial outlier en CAT pie
datos[9,11] <- NA # potencial outlier en GST tent
datos$SOD.tent[16] <- NA #outlier, enmascara diferencias
datos$SOD.tent[5] <- NA #outlier, enmascara diferencias
datos <- datos %>% select(-c(MDA.pie, MDA.tent)) # Primera medida de MDA no vale
### Ajuste de modelos ----
modelos <- lapply(colnames(datos[c(4:21)]), function(x){
aov(formula = as.formula(paste0(x, " ~ tratamiento")), datos)})
# NORMALIDAD DE RESIDUOS
sapply(modelos, function(x){
print(x$terms[[2]])
shapiro.test(residuals(x))})
# peso.total es unica variable que viola esta asuncion, no esta muy normalmente distribuida
# HOMOCEDASTICIDAD
sapply(modelos, function(x){
print(leveneTest(x))})
# todas las variables cumplen la asuncion de homocedasticidad
# RESULTADOS DEL ANOVA
for (i in c(1:18)) {
print(colnames(datos[4:21][i]))
print(summary(modelos[[i]]))}
n <- 12
i <- colnames(datos[4:21])[[n]]
tabla_summ <- datos %>%  group_by(tratamiento) %>%
summarise(media = mean(get(i), na.rm = T),
desvest = sd(get(i), na.rm = T),
error = desvest/sqrt(sum(!is.na(get(i)))))
if ((summary(modelos[[n]])[[1]][["Pr(>F)"]][1]) <= 0.05) {
tukey_loop <- TukeyHSD(modelos[[n]])
cld.tukey <- multcompLetters4(modelos[[n]], tukey_loop, reversed = T)
(letras <- rownames_to_column(as.data.frame(cld.tukey$tratamiento$Letters)))
colnames(letras) <- c("tratamiento", "tukey")
tabla_summ <- merge(tabla_summ, letras)
} else {
tabla_summ$tukey <- c("", "", "", "")
}
ggplot() +
geom_errorbar(data = tabla_summ, aes(x = tratamiento, ymax = media + error, ymin = media- error), width = 0.7, color = "gray55") +
geom_col(data = tabla_summ, aes(x = tratamiento, y = media, fill = tratamiento, color = tratamiento),  alpha = 0.1, linewidth = 1) +
geom_point(data = datos, aes(x = tratamiento, y = get(i), color = tratamiento), alpha = 0.8, size = 2) +
geom_text(data = tabla_summ, aes(x = tratamiento, y = media + error, label = tukey), color = "grey5", vjust = -0.8, size = 4.5, fontface = "bold") +
ylab(case_when(
i == "clorofila.total" ~ "μg clorofila /g tejido",
i == "proteina.tent" | i == "proteina.pie"  ~ " mg proteína / ml",
i == "MDA.pie.2" | i == "MDA.tent.2" ~ "μM  MDA",
i == "TEAC.pie" | i == "TEAC.tent"~ "μM equivalentes de Trolox",
i == "GST.pie" | i == "GST.tent" ~ "mU / mg  de proteína",
i == "DTD.pie" | i == "DTD.tent" ~ "mU / mg  de proteína",
TRUE ~ "U / mg  de proteína")) +
xlab("Tratamiento") +
#scale_color_manual(values = c("#0c8890", "#3EB59B","#E56A1C", "#FBBC4C")) +
ylim(c(0, 1.35*(max(tabla_summ$media) + max(tabla_summ$error)))) +
# Colores 1
scale_color_manual(values = c("#414066", "#69B4AB", "#FBBC4C", "#EF476F")) + # Colores 2
#scale_fill_manual(values = c("#1E5D56", "#0C8890", "#3EB59B", "#FBBC4C")) + # Colores 3
# ylim(c(0, case_when(i == "CAT.pie" ~  90,i == "DTD.pie" ~  15,i == "GST.pie" ~  450,i == "MDA.pie.2"| i == "MDA.tent.2" ~  90,i == "SOD.pie"| i == "SOD.tent" ~  150,  i == "TEAC.pie"| i == "TEAC.tent" ~  500,i == "CAT.tent" | i == "DTD.tent" | i == "GST.tent" ~ max(tabla_summ$media) * 2, TRUE ~ max(tabla_summ$media) * 1.2))) +
labs(title = i) +
theme_tfm()
setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
ggthemr("fresh")
source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
## Definicion del tema y formato de las graficas ----
theme_tfm <- function(){
theme(panel.background = element_rect(fill = "gray99"),
axis.text = element_text(size = 12),
plot.title = element_text(size = 18),
strip.text.x = element_text(size = 15, face = "bold", vjust = 0),
axis.title = element_text(size = 15),
legend.position = "none")
#strip.background = element_rect(colour = "black")
}
ggplot() +
geom_errorbar(data = tabla_summ, aes(x = tratamiento, ymax = media + error, ymin = media- error), width = 0.7, color = "gray55") +
geom_col(data = tabla_summ, aes(x = tratamiento, y = media, fill = tratamiento, color = tratamiento),  alpha = 0.1, linewidth = 1) +
geom_point(data = datos, aes(x = tratamiento, y = get(i), color = tratamiento), alpha = 0.8, size = 2) +
geom_text(data = tabla_summ, aes(x = tratamiento, y = media + error, label = tukey), color = "grey5", vjust = -0.8, size = 4.5, fontface = "bold") +
ylab(case_when(
i == "clorofila.total" ~ "μg clorofila /g tejido",
i == "proteina.tent" | i == "proteina.pie"  ~ " mg proteína / ml",
i == "MDA.pie.2" | i == "MDA.tent.2" ~ "μM  MDA",
i == "TEAC.pie" | i == "TEAC.tent"~ "μM equivalentes de Trolox",
i == "GST.pie" | i == "GST.tent" ~ "mU / mg  de proteína",
i == "DTD.pie" | i == "DTD.tent" ~ "mU / mg  de proteína",
TRUE ~ "U / mg  de proteína")) +
xlab("Tratamiento") +
#scale_color_manual(values = c("#0c8890", "#3EB59B","#E56A1C", "#FBBC4C")) +
ylim(c(0, 1.35*(max(tabla_summ$media) + max(tabla_summ$error)))) +
# Colores 1
scale_color_manual(values = c("#414066", "#69B4AB", "#FBBC4C", "#EF476F")) + # Colores 2
#scale_fill_manual(values = c("#1E5D56", "#0C8890", "#3EB59B", "#FBBC4C")) + # Colores 3
# ylim(c(0, case_when(i == "CAT.pie" ~  90,i == "DTD.pie" ~  15,i == "GST.pie" ~  450,i == "MDA.pie.2"| i == "MDA.tent.2" ~  90,i == "SOD.pie"| i == "SOD.tent" ~  150,  i == "TEAC.pie"| i == "TEAC.tent" ~  500,i == "CAT.tent" | i == "DTD.tent" | i == "GST.tent" ~ max(tabla_summ$media) * 2, TRUE ~ max(tabla_summ$media) * 1.2))) +
labs(title = i) +
theme_tfm()
ggplot() +
geom_errorbar(data = tabla_summ, aes(x = tratamiento, ymax = media + error, ymin = media- error), width = 0.7, color = "gray55") +
geom_col(data = tabla_summ, aes(x = tratamiento, y = media, fill = tratamiento, color = tratamiento),  alpha = 0.1, linewidth = 1) +
geom_point(data = datos, aes(x = tratamiento, y = get(i), color = tratamiento), alpha = 0.8, size = 2) +
geom_text(data = tabla_summ, aes(x = tratamiento, y = media + error, label = tukey), color = "grey5", vjust = -0.8, size = 4.5, fontface = "bold") +
ylab(case_when(
i == "clorofila.total" ~ "μg clorofila /g tejido",
i == "proteina.tent" | i == "proteina.pie"  ~ " mg proteína / ml",
i == "MDA.pie.2" | i == "MDA.tent.2" ~ "μM  MDA",
i == "TEAC.pie" | i == "TEAC.tent"~ "μM equivalentes de Trolox",
i == "GST.pie" | i == "GST.tent" ~ "mU / mg  de proteína",
i == "DTD.pie" | i == "DTD.tent" ~ "mU / mg  de proteína",
TRUE ~ "U / mg  de proteína")) +
xlab("Tratamiento") +
scale_color_manual(values = c("#0c8890", "#62BC69","#E56A1C", "#FBBC4C")) +
ylim(c(0, 1.35*(max(tabla_summ$media) + max(tabla_summ$error)))) +
# Colores 1
# ylim(c(0, case_when(i == "CAT.pie" ~  90,i == "DTD.pie" ~  15,i == "GST.pie" ~  450,i == "MDA.pie.2"| i == "MDA.tent.2" ~  90,i == "SOD.pie"| i == "SOD.tent" ~  150,  i == "TEAC.pie"| i == "TEAC.tent" ~  500,i == "CAT.tent" | i == "DTD.tent" | i == "GST.tent" ~ max(tabla_summ$media) * 2, TRUE ~ max(tabla_summ$media) * 1.2))) +
labs(title = i) +
theme_tfm()
ggplot() +
geom_errorbar(data = tabla_summ, aes(x = tratamiento, ymax = media + error, ymin = media- error), width = 0.7, color = "gray55") +
geom_col(data = tabla_summ, aes(x = tratamiento, y = media, fill = tratamiento, color = tratamiento),  alpha = 0.1, linewidth = 1) +
geom_point(data = datos, aes(x = tratamiento, y = get(i), color = tratamiento), alpha = 0.8, size = 2) +
geom_text(data = tabla_summ, aes(x = tratamiento, y = media + error, label = tukey), color = "grey5", vjust = -0.8, size = 4.5, fontface = "bold") +
ylab(case_when(
i == "clorofila.total" ~ "μg clorofila /g tejido",
i == "proteina.tent" | i == "proteina.pie"  ~ " mg proteína / ml",
i == "MDA.pie.2" | i == "MDA.tent.2" ~ "μM  MDA",
i == "TEAC.pie" | i == "TEAC.tent"~ "μM equivalentes de Trolox",
i == "GST.pie" | i == "GST.tent" ~ "mU / mg  de proteína",
i == "DTD.pie" | i == "DTD.tent" ~ "mU / mg  de proteína",
TRUE ~ "U / mg  de proteína")) +
xlab("Tratamiento") +
scale_color_manual(values = c("#0c8890", "#70C278","#E56A1C", "#FBBC4C")) +
ylim(c(0, 1.35*(max(tabla_summ$media) + max(tabla_summ$error)))) +
# Colores 1
# ylim(c(0, case_when(i == "CAT.pie" ~  90,i == "DTD.pie" ~  15,i == "GST.pie" ~  450,i == "MDA.pie.2"| i == "MDA.tent.2" ~  90,i == "SOD.pie"| i == "SOD.tent" ~  150,  i == "TEAC.pie"| i == "TEAC.tent" ~  500,i == "CAT.tent" | i == "DTD.tent" | i == "GST.tent" ~ max(tabla_summ$media) * 2, TRUE ~ max(tabla_summ$media) * 1.2))) +
labs(title = i) +
theme_tfm()
ggplot() +
geom_errorbar(data = tabla_summ, aes(x = tratamiento, ymax = media + error, ymin = media- error), width = 0.7, color = "gray55") +
geom_col(data = tabla_summ, aes(x = tratamiento, y = media, fill = tratamiento, color = tratamiento),  alpha = 0.1, linewidth = 1) +
geom_point(data = datos, aes(x = tratamiento, y = get(i), color = tratamiento), alpha = 0.8, size = 2) +
geom_text(data = tabla_summ, aes(x = tratamiento, y = media + error, label = tukey), color = "grey5", vjust = -0.8, size = 4.5, fontface = "bold") +
ylab(case_when(
i == "clorofila.total" ~ "μg clorofila /g tejido",
i == "proteina.tent" | i == "proteina.pie"  ~ " mg proteína / ml",
i == "MDA.pie.2" | i == "MDA.tent.2" ~ "μM  MDA",
i == "TEAC.pie" | i == "TEAC.tent"~ "μM equivalentes de Trolox",
i == "GST.pie" | i == "GST.tent" ~ "mU / mg  de proteína",
i == "DTD.pie" | i == "DTD.tent" ~ "mU / mg  de proteína",
TRUE ~ "U / mg  de proteína")) +
xlab("Tratamiento") +
scale_color_manual(values = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C")) +
ylim(c(0, 1.35*(max(tabla_summ$media) + max(tabla_summ$error)))) +
# Colores 1
# ylim(c(0, case_when(i == "CAT.pie" ~  90,i == "DTD.pie" ~  15,i == "GST.pie" ~  450,i == "MDA.pie.2"| i == "MDA.tent.2" ~  90,i == "SOD.pie"| i == "SOD.tent" ~  150,  i == "TEAC.pie"| i == "TEAC.tent" ~  500,i == "CAT.tent" | i == "DTD.tent" | i == "GST.tent" ~ max(tabla_summ$media) * 2, TRUE ~ max(tabla_summ$media) * 1.2))) +
labs(title = i) +
theme_tfm()
ggplot() +
geom_errorbar(data = tabla_summ, aes(x = tratamiento, ymax = media + error, ymin = media- error), width = 0.7, color = "gray55") +
geom_col(data = tabla_summ, aes(x = tratamiento, y = media, fill = tratamiento, color = tratamiento),  alpha = 0.1, linewidth = 1) +
geom_point(data = datos, aes(x = tratamiento, y = get(i), color = tratamiento), alpha = 0.8, size = 2) +
geom_text(data = tabla_summ, aes(x = tratamiento, y = media + error, label = tukey), color = "grey5", vjust = -0.8, size = 4.5, fontface = "bold") +
ylab(case_when(
i == "clorofila.total" ~ "μg clorofila /g tejido",
i == "proteina.tent" | i == "proteina.pie"  ~ " mg proteína / ml",
i == "MDA.pie.2" | i == "MDA.tent.2" ~ "μM  MDA",
i == "TEAC.pie" | i == "TEAC.tent"~ "μM equivalentes de Trolox",
i == "GST.pie" | i == "GST.tent" ~ "mU / mg  de proteína",
i == "DTD.pie" | i == "DTD.tent" ~ "mU / mg  de proteína",
TRUE ~ "U / mg  de proteína")) +
xlab("Tratamiento") +
scale_color_manual(values = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C")) +
ylim(c(0, 1.35*(max(tabla_summ$media) + max(tabla_summ$error)))) +
# Colores 1
# ylim(c(0, case_when(i == "CAT.pie" ~  90,i == "DTD.pie" ~  15,i == "GST.pie" ~  450,i == "MDA.pie.2"| i == "MDA.tent.2" ~  90,i == "SOD.pie"| i == "SOD.tent" ~  150,  i == "TEAC.pie"| i == "TEAC.tent" ~  500,i == "CAT.tent" | i == "DTD.tent" | i == "GST.tent" ~ max(tabla_summ$media) * 2, TRUE ~ max(tabla_summ$media) * 1.2))) +
labs(title = i) +
theme_tfm()
# Bucle construccion de estadisticos de resumen, grafica y test post hoc Tukey
for (n in c(1:18)) {
i <- colnames(datos[4:21])[[n]]
tabla_summ <- datos %>%  group_by(tratamiento) %>%
summarise(media = mean(get(i), na.rm = T),
desvest = sd(get(i), na.rm = T),
error = desvest/sqrt(sum(!is.na(get(i)))))
if ((summary(modelos[[n]])[[1]][["Pr(>F)"]][1]) <= 0.05) {
tukey_loop <- TukeyHSD(modelos[[n]])
cld.tukey <- multcompLetters4(modelos[[n]], tukey_loop, reversed = T)
(letras <- rownames_to_column(as.data.frame(cld.tukey$tratamiento$Letters)))
colnames(letras) <- c("tratamiento", "tukey")
tabla_summ <- merge(tabla_summ, letras)
} else {
tabla_summ$tukey <- c("", "", "", "")
}
(p <- barras_tfm())
ggsave(paste0("./resultados/graficas2/", i, "v2.png"), width = 800, height = 1000, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
}
source(file = "./scripts_enero_2024/1_funciones_graficas.R") # Arreglar setwd en el script citado
# Bucle construccion de estadisticos de resumen, grafica y test post hoc Tukey
for (n in c(1:18)) {
i <- colnames(datos[4:21])[[n]]
tabla_summ <- datos %>%  group_by(tratamiento) %>%
summarise(media = mean(get(i), na.rm = T),
desvest = sd(get(i), na.rm = T),
error = desvest/sqrt(sum(!is.na(get(i)))))
if ((summary(modelos[[n]])[[1]][["Pr(>F)"]][1]) <= 0.05) {
tukey_loop <- TukeyHSD(modelos[[n]])
cld.tukey <- multcompLetters4(modelos[[n]], tukey_loop, reversed = T)
(letras <- rownames_to_column(as.data.frame(cld.tukey$tratamiento$Letters)))
colnames(letras) <- c("tratamiento", "tukey")
tabla_summ <- merge(tabla_summ, letras)
} else {
tabla_summ$tukey <- c("", "", "", "")
}
(p <- barras_tfm())
ggsave(paste0("./resultados/graficas2/", i, "v2.png"), width = 800, height = 1000, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
}
# datos[20,6] <- NA # NO HACE FALTA QUITARLO
datos[8,5] <- NA # POTENCIAL OUTLIER EN CLOROFILA
datos[8,10] <- NA # potencial outlier en GST pie
datos[8,8] <- NA # potencial outlier en CAT pie
datos[9,11] <- NA # potencial outlier en GST tent
datos$SOD.tent[16] <- NA #outlier, enmascara diferencias
datos$SOD.tent[5] <- NA #outlier, enmascara diferencias
datos <- datos %>% select(-c(MDA.pie, MDA.tent)) # Primera medida de MDA no vale
modelos <- lapply(colnames(datos[c(4:21)]), function(x){
aov(formula = as.formula(paste0(x, " ~ tratamiento")), datos)})
# NORMALIDAD DE RESIDUOS
sapply(modelos, function(x){
print(x$terms[[2]])
shapiro.test(residuals(x))})
# HOMOCEDASTICIDAD
sapply(modelos, function(x){
print(leveneTest(x))})
for (i in c(1:18)) {
print(colnames(datos[4:21][i]))
print(summary(modelos[[i]]))}
# Bucle construccion de estadisticos de resumen, grafica y test post hoc Tukey
for (n in c(1:18)) {
i <- colnames(datos[4:21])[[n]]
tabla_summ <- datos %>%  group_by(tratamiento) %>%
summarise(media = mean(get(i), na.rm = T),
desvest = sd(get(i), na.rm = T),
error = desvest/sqrt(sum(!is.na(get(i)))))
if ((summary(modelos[[n]])[[1]][["Pr(>F)"]][1]) <= 0.05) {
tukey_loop <- TukeyHSD(modelos[[n]])
cld.tukey <- multcompLetters4(modelos[[n]], tukey_loop, reversed = T)
(letras <- rownames_to_column(as.data.frame(cld.tukey$tratamiento$Letters)))
colnames(letras) <- c("tratamiento", "tukey")
tabla_summ <- merge(tabla_summ, letras)
} else {
tabla_summ$tukey <- c("", "", "", "")
}
(p <- barras_tfm())
ggsave(paste0("./resultados/graficas2/", i, "v2.png"), width = 800, height = 1000, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
}
# Bucle construccion de estadisticos de resumen, grafica y test post hoc Tukey
for (n in c(1:18)) {
i <- colnames(datos[4:21])[[n]]
tabla_summ <- datos %>%  group_by(tratamiento) %>%
summarise(media = mean(get(i), na.rm = T),
desvest = sd(get(i), na.rm = T),
error = desvest/sqrt(sum(!is.na(get(i)))))
if ((summary(modelos[[n]])[[1]][["Pr(>F)"]][1]) <= 0.05) {
tukey_loop <- TukeyHSD(modelos[[n]])
cld.tukey <- multcompLetters4(modelos[[n]], tukey_loop, reversed = T)
(letras <- rownames_to_column(as.data.frame(cld.tukey$tratamiento$Letters)))
colnames(letras) <- c("tratamiento", "tukey")
tabla_summ <- merge(tabla_summ, letras)
} else {
tabla_summ$tukey <- c("", "", "", "")
}
(p <- barras_tfm())
ggsave(paste0("./resultados/graficas2/", i, "v2.png"), width = 800, height = 1000, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
}
# Bucle construccion de estadisticos de resumen, grafica y test post hoc Tukey
for (n in c(1:18)) {
i <- colnames(datos[4:21])[[n]]
tabla_summ <- datos %>%  group_by(tratamiento) %>%
summarise(media = mean(get(i), na.rm = T),
desvest = sd(get(i), na.rm = T),
error = desvest/sqrt(sum(!is.na(get(i)))))
if ((summary(modelos[[n]])[[1]][["Pr(>F)"]][1]) <= 0.05) {
tukey_loop <- TukeyHSD(modelos[[n]])
cld.tukey <- multcompLetters4(modelos[[n]], tukey_loop, reversed = T)
(letras <- rownames_to_column(as.data.frame(cld.tukey$tratamiento$Letters)))
colnames(letras) <- c("tratamiento", "tukey")
tabla_summ <- merge(tabla_summ, letras)
} else {
tabla_summ$tukey <- c("", "", "", "")
}
(p <- barras_tfm())
ggsave(paste0("./resultados/graficas2/", i, ".png"), width = 800, height = 1000, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
}
