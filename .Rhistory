### SETUP ----
library(tidyverse)
library(psych) #correlacion
library(MVN)
library(factoextra)
#setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
setwd("D:/collf/Documents/GitHub/TFM-Ortiguilla") #portatil
#setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
setwd("D:/collf/Documents/GitHub/TFM-Ortiguilla") #portatil
#setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
setwd("D:/collf/Documents/GitHub/TFM-Anemonia-sulcata") #portatil
#source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
source(file = "./scripts_enero_2024/0_data_home.R") # portatil
source(file = "./scripts_enero_2024/1_funciones_graficas.R")
ggthemr("fresh")
#setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
setwd("D:/collf/Documents/GitHub/TFM-Anemonia-sulcata") #portatil
#source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
source(file = "./scripts_enero_2024/0_data_home.R") # portatil
source(file = "./scripts_enero_2024/1_funciones_graficas.R")
source(file = "./scripts_enero_2024/1_funciones_graficas.R")
ggthemr("fresh")
datos <- datos %>% select(-c(MDA.pie, MDA.tent, proteina.pie, proteina.tent)) # Primera medida de MDA no vale
### Matriz de correlacion ----
datos_cor <- cor(datos[,6:19])
### Matriz de correlacion ----
datos_cor <- cor(datos[,6:19])
View(datos)
datos <- read.csv2("./datos/datos_TFM completos.csv", numerals = "warn.loss", encoding = "latin1")%>%
mutate(tratamiento = as.factor(tratamiento))
setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
#setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
setwd("D:/collf/Documents/GitHub/TFM-Anemonia-sulcata") #portatil
#source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
source(file = "./scripts_enero_2024/0_data_home.R") # portatil
source(file = "./scripts_enero_2024/1_funciones_graficas.R")
ggthemr("fresh")
datos <- datos %>% select(-c(MDA.pie, MDA.tent, proteina.pie, proteina.tent)) # Primera medida de MDA no vale
View(datos)
datos <- read.csv2("./datos/datos_TFM completos.csv", numerals = "warn.loss", encoding = "latin1")%>%
mutate(tratamiento = as.factor(tratamiento))
View(datos)
datos <- read.csv2("./datos/datos_TFM completos.csv", numerals = "warn.loss", encoding = "latin1")%>%
mutate(tratamiento = as.factor(tratamiento))
datos <- datos %>% select(-c(MDA.pie, MDA.tent, proteina.pie, proteina.tent)) # Primera medida de MDA no vale
#setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
setwd("D:/collf/Documents/GitHub/TFM-Anemonia-sulcata") #portatil
#source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
source(file = "./scripts_enero_2024/0_data_home.R") # portatil
source(file = "./scripts_enero_2024/1_funciones_graficas.R")
ggthemr("fresh")
datos <- datos %>% select(-c(MDA.pie, MDA.tent, proteina.pie, proteina.tent)) # Primera medida de MDA no vale
### Matriz de correlacion ----
datos_cor <- cor(datos[,6:19])
cor.plot(datos_cor)
det(datos_cor)
mvn(datos[,6:19], mvnTest = "mardia") # Sin proteina ni clorofila, el conjunto de datos es normal
mvn(datos[,6:19], mvnTest = "mardia") # Sin proteina ni clorofila, el conjunto de datos es normal
mvn(datos[,6:19], mvnTest = "mardia") # Sin proteina ni clorofila, el conjunto de datos es normal
cortest.bartlett(datos[,6:19], nrow(datos))
KMO(datos_cor) # 0.49 global, aceptable. GST tent, G6PDH tent y TEAC tent tienen poca correlacion parcial con el resto pero aportan informcion importante.
### Modelo PCA y eleccion de numero de componentes ----
cp <- princomp(~., data = datos[,6:19], cor = TRUE)
cp$loadings
write.csv2(cp$loadings, file = "./resultados/cargas.factoriales.csv")
summary(cp)
cp$sdev^2 # 5 componentes segun regla de Kaiser
fviz_pca_biplot(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
alpha.var = "cos2", col.var = "gray20",
repel = TRUE, label = "var", ggtheme = theme_tfm())
fviz_pca_ind(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
addEllipses = T, legend.title = "Treatment")
fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE,
ggtheme = theme_tfm())
install.packages("patchwork")
library(patchwork)
(biplot <- fviz_pca_biplot(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
alpha.var = "cos2", col.var = "gray20",
repel = TRUE, label = "var", ggtheme = theme_tfm()))
(indplot <- fviz_pca_ind(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
addEllipses = T, legend.title = "Treatment"))
(varplot <- fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE,
ggtheme = theme_tfm()))
(p1 <- varplot + indplot )
(indplot <- fviz_pca_ind(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
addEllipses = T, legend.title = "Treatment",
ggtheme = theme_tfm()))
(p1 <- varplot + indplot )
(varplot <- fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE, legend.title = "Contribution",
ggtheme = theme_tfm()))
(varplot <- fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE,
ggtheme = theme_tfm()))
(indplot <- fviz_pca_ind(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
addEllipses = T, legend.title = "Treatment",
ggtheme = theme_tfm()))
(indplot <- fviz_pca_ind(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
addEllipses = T, legend.title = "Treatment",
ggtheme = theme_tfm()) +
theme(legend.position = "right"))
(varplot <- fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE,
ggtheme = theme_tfm()) +
theme(legend.position = "right"))
(varplot <- fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE, legend.title = "Contribution"
ggtheme = theme_tfm()) +
(varplot <- fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE, legend.title = "Contribution",
ggtheme = theme_tfm()) +
theme(legend.position = "right"))
(p1 <- varplot + indplot )
(p1 <- varplot + indplot )
library(patchwork)
(p1 <- varplot + indplot )
win.graph
win.graph()
(p1 <- varplot + indplot )
### Añadimos las puntuaciones a los datos ----
datos_pca <- datos[-8,]
datos_pca <- cbind(datos_pca, cp1 = cp2$scores[,1], cp2 = cp2$scores[,2], cp3 = cp2$scores[,3], cp4 = cp2$scores[,4])
datos_pca <- cbind(datos_pca, cp1 = cp$scores[,1], cp2 = cp$scores[,2], cp3 = cp$scores[,3], cp4 = cp$scores[,4])
### Añadimos las puntuaciones a los datos ----
datos_pca <- datos
datos_pca <- cbind(datos_pca, cp1 = cp$scores[,1], cp2 = cp$scores[,2], cp3 = cp$scores[,3], cp4 = cp$scores[,4])
View(datos_pca)
ggsave(p1, "./resultados/graficas2/PCA_doble.png", width = 1000, height = 600, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
ggsave("./resultados/graficas2/PCA_doble.png", width = 1000, height = 600, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
ggsave("./resultados/graficas2/PCA_doble.png", width = 2000, height = 1000, units = "px", #para clorofila 730, 730
scale = 2, dpi = "retina")
datos <- datos %>% select(-c(MDA.pie, MDA.tent, proteina.pie, proteina.tent)) %>%
rename(MDA.col = MDA.pie.2, MDA.tent = MDA.tent.2,
SOD.col = SOD.pie, CAT.col = CAT.pie,
GST.col = GST.pie, DTD.col = DTD.pie,
G6PDH.col = G6PDH.pie, TEAC.col = TEAC.tent)
#setwd("C:/Users/Usuario/Documents/GitHub/TFM-Anemonia-sulcata")
setwd("D:/collf/Documents/GitHub/TFM-Anemonia-sulcata") #portatil
#source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
source(file = "./scripts_enero_2024/0_data_home.R") # portatil
source(file = "./scripts_enero_2024/1_funciones_graficas.R")
ggthemr("fresh")
datos <- datos %>% select(-c(MDA.pie, MDA.tent, proteina.pie, proteina.tent)) %>%
rename(MDA.col = MDA.pie.2, MDA.tent = MDA.tent.2,
SOD.col = SOD.pie, CAT.col = CAT.pie,
GST.col = GST.pie, DTD.col = DTD.pie,
G6PDH.col = G6PDH.pie, TEAC.col = TEAC.tent)
#source(file = "./scripts_enero_2024/0_data_lab.R") # Laboratorio
source(file = "./scripts_enero_2024/0_data_home.R") # portatil
source(file = "./scripts_enero_2024/1_funciones_graficas.R")
ggthemr("fresh")
datos <- datos %>% select(-c(MDA.pie, MDA.tent, proteina.pie, proteina.tent)) %>%
rename(MDA.col = MDA.pie.2, MDA.tent = MDA.tent.2,
SOD.col = SOD.pie, CAT.col = CAT.pie,
GST.col = GST.pie, DTD.col = DTD.pie,
G6PDH.col = G6PDH.pie, TEAC.col = TEAC.pie)
### Matriz de correlacion ----
datos_cor <- cor(datos[,6:19])
cor.plot(datos_cor)
det(datos_cor)
mvn(datos[,6:19], mvnTest = "mardia") # Sin proteina ni clorofila, el conjunto de datos es normal
cortest.bartlett(datos[,6:19], nrow(datos))
KMO(datos_cor) # 0.49 global, aceptable. GST tent, G6PDH tent y TEAC tent tienen poca correlacion parcial con el resto pero aportan informcion importante.
### Modelo PCA y eleccion de numero de componentes ----
cp <- princomp(~., data = datos[,6:19], cor = TRUE)
cp$loadings
write.csv2(cp$loadings, file = "./resultados/cargas.factoriales.csv")
summary(cp)
# 5 componentes ya superan 70 % varianza
screeplot(cp, type = "lines") # 4 componentes
cp$sdev^2 # 5 componentes segun regla de Kaiser
(biplot <- fviz_pca_biplot(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
alpha.var = "cos2", col.var = "gray20",
repel = TRUE, label = "var", ggtheme = theme_tfm()))
(biplot <- fviz_pca_biplot(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
alpha.var = "cos2", col.var = "gray20",
repel = TRUE, label = "var", ggtheme = theme_tfm()))
(indplot <- fviz_pca_ind(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
addEllipses = T, legend.title = "Treatment",
ggtheme = theme_tfm()) +
theme(legend.position = "right"))
(biplot <- fviz_pca_biplot(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
alpha.var = "cos2", col.var = "gray20",
repel = TRUE, label = "var", ggtheme = theme_tfm()))
### SETUP ----
library(tidyverse)
(biplot <- fviz_pca_biplot(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
alpha.var = "cos2", col.var = "gray20",
repel = TRUE, label = "var", ggtheme = theme_tfm()))
dev.off()
(biplot <- fviz_pca_biplot(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
alpha.var = "cos2", col.var = "gray20",
repel = TRUE, label = "var", ggtheme = theme_tfm()))
(indplot <- fviz_pca_ind(cp, col.ind = datos$tratamiento,
palette = c("#0c8890", "#54B65D","#E56A1C", "#FBBC4C"),
addEllipses = T, legend.title = "Treatment",
ggtheme = theme_tfm()) +
theme(legend.position = "right"))
(varplot <- fviz_pca_var(cp, col.var = "contrib",
gradient.cols = c("#0c8890", "#54B65D","#E56A1C"),
repel = TRUE, legend.title = "Contribution",
ggtheme = theme_tfm()) +
theme(legend.position = "right"))
